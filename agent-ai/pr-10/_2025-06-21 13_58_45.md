### 

用户:
怎么运行

Claude:
��据代码分析，这个 Universal Agent System 是一个复杂的多代理AI系统。以下是运行它的几种方式：

## 1. 本地开发运行

### 准备工作

首先安装依赖：

```bash
# 创建虚拟环境
python -m venv venv
source venv/bin/activate  # Linux/Mac
# 或 venv\Scripts\activate  # Windows

# 安装依赖（从 system-integration.py 中的 REQUIREMENTS）
pip install fastapi uvicorn pydantic aiohttp redis sqlalchemy asyncpg prometheus-client structlog
# ... 其他依赖
```

### 配置环境变量

```bash
# 创建 .env 文件
export CLAUDE_API_KEY="your-claude-api-key"
export QWEN_API_KEY="your-qwen-api-key"
export DATABASE_URL="postgresql+asyncpg://user:password@localhost/universal_agent"
export REDIS_URL="redis://localhost:6379"
export JWT_SECRET="your-secret-key"
```

### 通过 CLI 运行

根据 `system-integration.py` 中的 CLI 接口：

```bash
# 启动系统
python system-integration.py start --dev

# 创建代理
python system-integration.py agent create code --id code_expert_1

# 提交任务
python system-integration.py task submit code_generation --params '{"requirements": "创建一个网页爬虫"}'

# 查看任务状态
python system-integration.py task status <task_id>
```

## 2. Docker 运行

系统提供了 Docker Compose 配置：

```bash
# 创建 docker-compose.yml（内容在 system-integration.py 的 DOCKER_COMPOSE 变量中）
docker-compose up -d

# 这会启动：
# - API 服务器 (端口 8000)
# - PostgreSQL 数据库
# - Redis 缓存
# - Prometheus 监控
# - Grafana 仪表板
```

## 3. 简单测试运行

如果只想测试核心功能，可以运行 `universal-agent-core.py`：

```python
# universal_agent_test.py
import asyncio
from universal_agent_core import create_universal_agent_system, Task, Priority

async def test_system():
    # 创建系统
    manager = create_universal_agent_system()
    
    # 启动系统
    await manager.start()
    
    # 提交代码生成任务
    task = Task(
        type="code_generation",
        description="创建一个简单的REST API",
        parameters={
            'language': 'python',
            'framework': 'fastapi',
            'requirements': ['用户注册', '用户登录', 'JWT认证']
        },
        priority=Priority.HIGH
    )
    
    task_id = await manager.submit_task(task)
    print(f"任务已提交: {task_id}")
    
    # 等待一段时间
    await asyncio.sleep(10)
    
    # 停止系统
    await manager.stop()

# 运行测试
asyncio.run(test_system())
```

## 4. API 方式运行

通过 FastAPI 提供的 REST API：

```bash
# 启动 API 服务器
uvicorn system_integration:app --host 0.0.0.0 --port 8000

# API 端点：
# GET  /                     - 系统状态
# POST /agents              - 创建代理
# GET  /agents              - 列出代理
# POST /tasks               - 提交任务
# GET  /tasks/{task_id}     - 获取任务状态
# POST /workflows           - 创建工作流
# GET  /health              - 健康检查
```

使用 API 的示例：

```python
import httpx

async def use_api():
    async with httpx.AsyncClient() as client:
        # 创建代码代理
        response = await client.post(
            "http://localhost:8000/agents",
            json={
                "agent_type": "code",
                "agent_id": "code_expert_1"
            }
        )
        print(response.json())
        
        # 提交任务
        response = await client.post(
            "http://localhost:8000/tasks",
            json={
                "task_type": "code_generation",
                "parameters": {
                    "requirements": "创建一个TODO应用",
                    "language": "python"
                }
            }
        )
        task_info = response.json()
        print(f"任务ID: {task_info['task_id']}")
```

## 5. 生产环境部署

### Kubernetes 部署

```bash
# 应用 Kubernetes 配置
kubectl apply -f k8s/

# 或使用提供的部署命令
python system-integration.py deploy kubernetes
```

## 注意事项

1. **API密钥**：需要有效的 Claude 和 Qwen API 密钥
2. **资源需求**：系统需要 Redis 和 PostgreSQL
3. **成本控制**：系统内置了成本控制功能，可以设置预算限制
4. **监控**：可通过 Prometheus/Grafana 监控系统状态

## 最小化运行示例

如果只想快速测试某个功能，比如代码生成：

```python
# minimal_test.py
import asyncio
from agents.code_agent import CodeDevelopmentAgent
from core.base_agent import AgentConfig, AgentRole, Task
from models.model_manager import ModelProvider

async def minimal_test():
    # 创建代码代理
    config = AgentConfig(
        role=AgentRole.CODE_DEVELOPER,
        model_provider=ModelProvider.CLAUDE_4_SONNET,
        temperature=0.3
    )
    
    agent = CodeDevelopmentAgent("test_agent", config)
    await agent.start()
    
    # 生成代码
    result = await agent.generate_code(
        requirements="创建一个简单的计算器类",
        language="python"
    )
    
    print(result.code)
    
    await agent.stop()

asyncio.run(minimal_test())
```

这个系统非常复杂，建议从简单的测试开始，逐步了解各个组件的功能。


